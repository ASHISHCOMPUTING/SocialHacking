<html>
<head>
	<style>
	body {
		padding: 1em;
	}
	</style>

	<script src="http://codeorigin.jquery.com/jquery-2.0.3.min.js"></script>
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/sugar/1.3.9/sugar.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>

	<script src="db.js"></script>
</head>
<body>
	<script>
	dates = [
		"September 9, 2013",
		"September 16, 2013",
		"September 23, 2013",
		"September 30, 2013",
		"October 7, 2013",
		"October 21, 2013",
		"October 28, 2013",
		"November 4, 2013",
		"November 11, 2013",
		"November 18, 2013",
		"November 25, 2013",
		"December 2, 2013",
	];

	statuses = db['statuses'];

	// remove retweets
	statuses = statuses.findAll(function(status) {
		return !status.retweeted_status;
	});

	// get unique users
	users = statuses.map(function(status) {
		return status.user.screen_name;
	}).unique().sort();

	document.write("<table class='table table-bordered table-striped table-condensed'>");
	document.write("<thead><tr>");
	document.write("<th>Person</th>");
	dates.each(function(date) {
		document.write("<th>" + new Date(date).toString("MMM d") + "</th>");
	});
	document.write("</tr></thead>");
	document.write("<tbody>");
	users.each(function(user) {
		document.write("<tr>");
		document.write("<td>" + user + "</td>");
		dates.each(function(date) {
			// get date range for this week
			startDate = new Date(date);
			endDate = startDate.clone().addWeeks(1);
			// find all tweets from this user in date range
			cur = statuses.findAll(function(status) {
				return status.user.screen_name == user &&
					new Date(status.created_at).between(startDate, endDate);
			});
			document.write("<td>" + cur.length + "</td>");
		});
		document.write("</tr>");
	});
	document.write("</tbody>");
	document.write("</table>");

	document.write("<hr/>");

	document.write("<h1>" + statuses.length + " results</h1>");
	document.write("<table class='table table-bordered table-striped table-condensed'>");
	document.write("<thead><tr><th>Profile</th><th>Name</th><th>Screen name</th><th>Tweet</th></tr></thead>");
	document.write("<tbody>");
	statuses.each(function(status) {
		document.write("<tr>");
		document.write("<td><img src='" + status.user.profile_image_url + "'/></td>");
		document.write("<td>" + status.user.name + "</td>");
		document.write("<td>" + status.user.screen_name + "</td>");
		document.write("<td>" + status.text + "</td>");
		document.write("</tr>");
	});
	document.write("</tbody>");
	document.write("</table>");
	</script>
</body>
</html>